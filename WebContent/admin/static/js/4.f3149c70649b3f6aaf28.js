webpackJsonp([4],{"0k87":function(t,e,s){s("SSy3"),t.exports=s("ZuHZ").Object.keys},A9zj:function(t,e,s){"use strict";e.__esModule=!0,e.default=function(t,e){var s={};for(var i in t)e.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i]);return s}},Gv5q:function(t,e,s){s("VZ9x"),t.exports=s("ZuHZ").Object.values},KkUl:function(t,e,s){var i=s("uoC7"),o=s("RY2v"),a=s("KKnT"),n=s("2raJ").f;t.exports=function(t){return function(e){for(var s,l=a(e),r=o(l),c=r.length,u=0,p=[];c>u;)s=r[u++],i&&!n.call(l,s)||p.push(t?[s,l[s]]:l[s]);return p}}},MgeX:function(t,e,s){t.exports={default:s("Gv5q"),__esModule:!0}},SSy3:function(t,e,s){var i=s("WXuS"),o=s("RY2v");s("adHB")("keys",function(){return function(t){return o(i(t))}})},UPbl:function(t,e){},VZ9x:function(t,e,s){var i=s("Wtcz"),o=s("KkUl")(!1);i(i.S,"Object",{values:function(t){return o(t)}})},ZLEe:function(t,e,s){t.exports={default:s("0k87"),__esModule:!0}},adHB:function(t,e,s){var i=s("Wtcz"),o=s("ZuHZ"),a=s("2gH+");t.exports=function(t,e){var s=(o.Object||{})[t]||Object[t],n={};n[t]=e(s),i(i.S+i.F*a(function(){s(1)}),"Object",n)}},vsuj:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("ZLEe"),o=s.n(i),a=s("MgeX"),n=s.n(a),l=s("A9zj"),r=s.n(l),c=s("3cXf"),u=s.n(c),p=s("aA9S"),d=s.n(p),v=(s("oTFt"),s("9GaO"),s("v/ij"),s("aiqZ")),f={name:"g",components:{quillEditor:v.quillEditor},props:{step:{type:Number,default:1},isEdit:{type:Boolean,default:!1},oldGoods:Object},data:function(){return{valid:!1,editorOption:{placeholder:"编写商品描述信息，让客户了解你的商品"},brandOptions:[],specifications:[],template:[],skuTemplate:[],skus:[],headers:[],goods:{categories:null,brandId:null,title:"",subTitle:"",spuDetail:{packingList:"",afterService:"",description:"",specTemplate:"",specifications:[]}}}},methods:{deleteOption:function(t,e){this.skuTemplate[t].options.splice(e,1)},loadSku:function(t,e,s,i){for(var o=t[s],a=0;a<o.options.length;a++){var n={};n[o.k]=o.options[a],d()(n,i),s===t.length-1?(n.indexes+=a,e.push(n)):(n.indexes+=a+"_",this.loadSku(t,e,s+1,n))}},submit:function(){var t=this;if(!this.goods.categories||this.goods.categories.length<3)this.$message.error("商品分类填写不正确！");else if(!this.skus||this.skus.length<=0)this.$message.error("请填写sku信息！");else{this.goods.cid1=this.goods.categories[0].id,this.goods.cid2=this.goods.categories[1].id,this.goods.cid3=this.goods.categories[2].id;var e={};this.skuTemplate.forEach(function(t){t.options.length>0&&(e[t.k]=t.options)}),this.goods.spuDetail.specTemplate=u()(e);var s=[];Object.deepCopy(this.specifications,s),s.forEach(function(e){e.params.forEach(function(e){e.global||(e.options=t.skuTemplate[e.k])})}),this.goods.spuDetail.specifications=u()(s),this.goods.skus=this.skus.filter(function(t){return t.enable}).map(function(e){var s=e.price,i=e.stock,o=e.enable,a=e.indexes,l=e.images,c=r()(e,["price","stock","enable","indexes","images"]),p=t.goods.title;return n()(c).forEach(function(t){return p+=" "+t}),{id:e.id||null,enable:o,title:p,images:l&&l.length>0?l.join(","):"",price:t.$format(s),ownSpec:u()(c),indexes:a,stock:{stock:i}}}),this.$http({url:"/item/goods",method:this.isEdit?"put":"post",data:this.goods}).then(function(){t.$message.success("提交商品成功！"),t.$emit("closeForm")}).catch(function(e){console.log(e),t.$message.error("提交商品失败！"),t.$emit("closeForm")})}}},watch:{oldGoods:{deep:!0,handler:function(t){null!=t&&this.isEdit&&Object.deepCopy(t,this.goods)}},"goods.categories":{deep:!0,handler:function(t){var e=this;this.$http.get("/item/brand/cid/"+t[2].id).then(function(t){e.brandOptions=t.data}),this.$http.get("/item/spec/"+t[2].id).then(function(t){e.specifications=t.data,e.template=[],e.skuTemplate=[];for(var s=0;s<e.specifications.length;s++){for(var i=e.specifications[s].params,o=i.length,a=0;a<i.length;a++){var n=i[a];n.global||(e.template.push({k:n.k,options:n.options}),e.skuTemplate.push({k:n.k,options:[]}),o--),e.isEdit&&(n.v=e.goods.spuDetail.specifications[s].params[a].v)}0===o&&(e.specifications[s].empty=!0)}e.isEdit&&e.skuTemplate.forEach(function(t){t.options=e.goods.spuDetail.specTemplate[t.k]})})}},skuTemplate:{deep:!0,handler:function(t){var e=this,s=t.filter(function(t){return t.options.length>0});s.length<=0||(this.headers=[],this.skus=[],this.loadSku(s,this.skus,0,{price:null,stock:null,indexes:"",enable:!1}),this.isEdit&&this.$http.get("/item/goods/sku/list",{params:{id:this.goods.id}}).then(function(t){e.skus.forEach(function(s){t.data.forEach(function(t){s.indexes===t.indexes&&(s.id=t.id,s.price=e.$format(t.price),s.stock=t.stock.stock,s.images=t.images.split(","),s.enable=t.enable)})})}),this.headers=[{text:"price",align:"center",sortable:!1,value:"name"}],this.headers=[],this.skus.length>0&&o()(this.skus[0]).forEach(function(t){var s="80";"indexes"!=t&&("price"==t?(t="价格",s="50"):"stock"==t?(t="库存",s="50"):"enable"==t&&(t="是否启用",s="30"),e.headers.push({text:t,align:"center",sortable:!1,value:t,width:s}))}))}}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-stepper",{attrs:{value:t.step}},[s("v-stepper-header",[s("v-stepper-step",{attrs:{step:"1",complete:t.step>1}},[t._v("基本信息")]),t._v(" "),s("v-divider"),t._v(" "),s("v-stepper-step",{attrs:{step:"2",complete:t.step>2}},[t._v("商品描述")]),t._v(" "),s("v-divider"),t._v(" "),s("v-stepper-step",{attrs:{step:"3",complete:t.step>3}},[t._v("规格参数")]),t._v(" "),s("v-divider"),t._v(" "),s("v-stepper-step",{attrs:{step:"4"}},[t._v("SKU属性")])],1),t._v(" "),s("v-stepper-items",[s("v-stepper-content",{attrs:{step:"1"}},[s("v-layout",{attrs:{"justify-center":""}},[s("v-flex",{attrs:{xs10:""}},[s("v-form",{ref:"basic",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs5:""}},[s("v-cascader",{attrs:{url:"/item/category/list",required:"","show-all-levels":"",label:"商品分类"},model:{value:t.goods.categories,callback:function(e){t.$set(t.goods,"categories",e)},expression:"goods.categories"}})],1),t._v(" "),s("v-flex",{attrs:{"offset-xs2":"",xs5:""}},[s("v-select",{attrs:{label:"所属品牌",items:t.brandOptions,dense:"",autocomplete:"","item-text":"name","item-value":"id",rules:[function(t){return!!t||"品牌不能为空"}],required:""},model:{value:t.goods.brandId,callback:function(e){t.$set(t.goods,"brandId",e)},expression:"goods.brandId"}})],1)],1),t._v(" "),s("v-text-field",{attrs:{label:"商品标题",counter:200,required:"",rules:[function(t){return!!t||"商品标题不能为空"}]},model:{value:t.goods.title,callback:function(e){t.$set(t.goods,"title",e)},expression:"goods.title"}}),t._v(" "),s("v-text-field",{attrs:{label:"商品卖点",counter:200},model:{value:t.goods.subTitle,callback:function(e){t.$set(t.goods,"subTitle",e)},expression:"goods.subTitle"}}),t._v(" "),s("v-text-field",{attrs:{label:"包装清单",counter:1e3,"multi-line":"",rows:3},model:{value:t.goods.spuDetail.packingList,callback:function(e){t.$set(t.goods.spuDetail,"packingList",e)},expression:"goods.spuDetail.packingList"}}),t._v(" "),s("v-text-field",{attrs:{label:"售后服务",counter:1e3,"multi-line":"",rows:3},model:{value:t.goods.spuDetail.afterService,callback:function(e){t.$set(t.goods.spuDetail,"afterService",e)},expression:"goods.spuDetail.afterService"}}),t._v(" "),s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs3:""}}),t._v(" "),s("v-flex")],1)],1)],1)],1)],1),t._v(" "),s("v-stepper-content",{attrs:{step:"2"}},[s("quill-editor",{attrs:{options:t.editorOption},model:{value:t.goods.spuDetail.description,callback:function(e){t.$set(t.goods.spuDetail,"description",e)},expression:"goods.spuDetail.description"}})],1),t._v(" "),s("v-stepper-content",{attrs:{step:"3"}},[s("v-flex",{attrs:{"offset-xs1":"",xs10:""}},t._l(t.specifications,function(e,i){return e.empty?t._e():s("v-card",{key:i,staticClass:"my-2"},[s("v-card-title",[s("h4",[t._v(t._s(e.group))])]),t._v(" "),s("v-divider"),t._v(" "),s("v-layout",{attrs:{column:"","justify-center":""}},t._l(e.params,function(e,i){return s("v-flex",{key:i,attrs:{xs8:""}},[e.global?s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{"offset-xs2":"",xs8:""}},[e.options.length<=0?s("v-text-field",{attrs:{suffix:e.unit||"",label:e.k},model:{value:e.v,callback:function(s){t.$set(e,"v",s)},expression:"param.v"}}):s("v-select",{attrs:{label:e.k,items:e.options},model:{value:e.v,callback:function(s){t.$set(e,"v",s)},expression:"param.v"}})],1)],1):t._e()],1)}),1)],1)}),1)],1),t._v(" "),s("v-stepper-content",{attrs:{step:"4"}},[s("v-layout",{attrs:{column:""}},[s("h3",[t._v("sku属性：")]),t._v(" "),s("v-divider"),t._v(" "),s("v-flex",{attrs:{"offset-xs1":""}},t._l(t.template,function(e,i){return s("div",{key:i},[s("h4",[t._v(t._s(e.k)+":")]),t._v(" "),e.options.length<=0?s("div",{staticClass:"px-5"},[s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs8:""}},[s("v-text-field",{attrs:{label:"请输入新的"+e.k},model:{value:t.skuTemplate[i].options[0],callback:function(e){t.$set(t.skuTemplate[i].options,0,e)},expression:"skuTemplate[i].options[0]"}})],1),t._v(" "),s("v-spacer"),t._v(" "),s("v-flex",{attrs:{xs1:""}},[s("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){return t.deleteOption(i,0)}}},[s("i",{staticClass:"el-icon-delete"})])],1)],1),t._v(" "),t._l(t.skuTemplate[i].options.length,function(o){return s("v-layout",{key:o,attrs:{row:""}},[s("v-flex",{attrs:{xs8:""}},[s("v-text-field",{attrs:{label:"请输入新的"+e.k},model:{value:t.skuTemplate[i].options[o],callback:function(e){t.$set(t.skuTemplate[i].options,o,e)},expression:"skuTemplate[i].options[i2]"}})],1),t._v(" "),s("v-spacer"),t._v(" "),s("v-flex",{attrs:{xs1:""}},[s("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){return t.deleteOption(i,o)}}},[s("i",{staticClass:"el-icon-delete"})])],1)],1)})],2):s("div",{staticClass:"px-5"},[s("v-container",{attrs:{fluid:"","grid-list-xs":""}},[s("v-layout",{attrs:{row:"",wrap:""}},t._l(e.options,function(e){return s("v-flex",{key:e,attrs:{xs3:""}},[s("v-checkbox",{attrs:{color:"primary",label:e,value:e},model:{value:t.skuTemplate[i].options,callback:function(e){t.$set(t.skuTemplate[i],"options",e)},expression:"skuTemplate[i].options"}})],1)}),1)],1)],1)])}),0),t._v(" "),s("v-divider"),t._v(" "),s("h3",[t._v("sku列表：")]),t._v(" "),s("v-flex",[s("v-data-table",{staticClass:"elevation-2",attrs:{headers:t.headers,items:t.skus,"hide-actions":"","item-key":"indexes"},scopedSlots:t._u([{key:"items",fn:function(e){return[s("tr",{on:{click:function(t){e.expanded=!e.expanded}}},[t._l(Object.entries(e.item),function(e){var i=e[0],o=e[1];return["id","price","stock","enable","indexes","images"].includes(i)?t._e():s("td",{key:i,staticClass:"text-xs-center"},[t._v(t._s(o)+"\n                ")])}),t._v(" "),s("td",{staticClass:"text-xs-center"},[s("v-text-field",{attrs:{"single-line":"",label:"0",rules:[function(t){return/^([1-9]\d*)\.?(\d{0,2})$/.test(t)||"价格格式错误"}]},model:{value:e.item.price,callback:function(s){t.$set(e.item,"price",s)},expression:"props.item.price"}})],1),t._v(" "),s("td",{staticClass:"text-xs-center"},[s("v-text-field",{attrs:{"single-line":"",label:"0",rules:[function(t){return/^[1-9]\d*$/.test(t)||"库存必须是整数"}]},model:{value:e.item.stock,callback:function(s){t.$set(e.item,"stock",s)},expression:"props.item.stock"}})],1),t._v(" "),s("td",{staticClass:"text-xs-center"},[s("v-checkbox",{model:{value:e.item.enable,callback:function(s){t.$set(e.item,"enable",s)},expression:"props.item.enable"}})],1)],2)]}},{key:"expand",fn:function(e){return e.item.enable?[s("v-card",{staticClass:"pb-3",attrs:{flat:""}},[s("v-card-title",[t._v("为商品上传图片：")]),t._v(" "),s("v-card-text",[s("v-upload",{attrs:{multiple:"",url:"/item/upload"},model:{value:e.item.images,callback:function(s){t.$set(e.item,"images",s)},expression:"props.item.images"}})],1)],1)]:void 0}}],null,!0)},[t._v(" "),t._v(" "),s("template",{slot:"no-data"},[s("v-alert",{attrs:{value:!0,color:"warning",icon:"warning"}},[t._v("\n                请至少选择一个商品属性\n              ")])],1)],2)],1)],1),t._v(" "),s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{"offset-xs5":"",xs2:""}},[s("v-btn",{attrs:{color:"primary"},on:{click:t.submit}},[t._v("保存商品")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var g=s("C7Lr")(f,m,!1,function(t){s("UPbl")},"data-v-1eb3d685",null);e.default=g.exports}});
//# sourceMappingURL=4.f3149c70649b3f6aaf28.js.map