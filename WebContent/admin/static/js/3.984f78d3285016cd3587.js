webpackJsonp([3,4],{"0k87":function(t,e,s){s("SSy3"),t.exports=s("ZuHZ").Object.keys},"97dZ":function(t,e){},A9zj:function(t,e,s){"use strict";e.__esModule=!0,e.default=function(t,e){var s={};for(var i in t)e.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i]);return s}},Gv5q:function(t,e,s){s("VZ9x"),t.exports=s("ZuHZ").Object.values},KkUl:function(t,e,s){var i=s("uoC7"),a=s("RY2v"),o=s("KKnT"),n=s("2raJ").f;t.exports=function(t){return function(e){for(var s,l=o(e),r=a(l),c=r.length,d=0,u=[];c>d;)s=r[d++],i&&!n.call(l,s)||u.push(t?[s,l[s]]:l[s]);return u}}},MgeX:function(t,e,s){t.exports={default:s("Gv5q"),__esModule:!0}},SSy3:function(t,e,s){var i=s("WXuS"),a=s("RY2v");s("adHB")("keys",function(){return function(t){return a(i(t))}})},UPbl:function(t,e){},VZ9x:function(t,e,s){var i=s("Wtcz"),a=s("KkUl")(!1);i(i.S,"Object",{values:function(t){return a(t)}})},ZLEe:function(t,e,s){t.exports={default:s("0k87"),__esModule:!0}},Zusx:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});s("vsuj");var i=s("MJ8A"),a={name:"it",components:{GooForm:GooForm},data:function(){return{search:{key:"",saleable:!0},totalItems:0,items:[],loading:!0,pagination:{},headers:[{text:"id",align:"center",value:"id"},{text:"标题",align:"center",sortable:!1,value:"name"},{text:"商品分类",align:"center",sortable:!1,value:"image"},{text:"品牌",align:"center",value:"letter",sortable:!0},{text:"操作",align:"center",value:"id",sortable:!1}],show:!1,selectedGoods:null,isEdit:!1,step:1}},watch:{pagination:{handler:function(){this.getDataFromApi()},deep:!0},search:{handler:function(){this.getDataFromApi()},deep:!0}},mounted:function(){this.getDataFromApi()},methods:{closeForm:function(){this.isEdit=!1,this.show=!1,this.step=1,this.selectedGoods=null,this.getDataFromApi()},lastStep:function(){1!==this.step&&this.step--},nextStep:function(){4!==this.step&&this.$refs.goodsForm.$refs.basic.validate()&&this.step++},addItem:function(){this.selectedGoods=null,this.isEdit=!1,this.show=!0},editItem:function(t){var e=this;this.selectedGoods=t;var s=t.categoryName.split("/");this.selectedGoods.categories=[{id:t.cid1,name:s[0]},{id:t.cid2,name:s[1]},{id:t.cid3,name:s[2]}],this.$http.get("/item/goods/spu/detail/"+t.id).then(function(t){e.selectedGoods.spuDetail=t.data,e.selectedGoods.spuDetail.specTemplate=JSON.parse(t.data.specTemplate),e.selectedGoods.spuDetail.specifications=JSON.parse(t.data.specifications)}),this.isEdit=!0,this.show=!0},deleteItem:function(t){var e=this;this.$message.confirm("此操作将永久删除该商品, 是否继续?").then(function(){e.$http.delete("/item/goods?id="+t).then(function(){e.getDataFromApi(),e.$message.info("删除成功!")})}).catch(function(){e.$message.info("已取消删除")})},getDataFromApi:function(){var t=this;this.loading=!0,setTimeout(function(){t.items=i.b.slice(0,4),t.totalItems=25,t.loading=!1},300)}}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",[s("v-toolbar",{staticClass:"elevation-0"},[s("v-btn",{attrs:{color:"primary"},on:{click:t.addItem}},[t._v("新增商品")]),t._v(" "),s("v-spacer"),t._v(" "),s("v-flex",{attrs:{xs3:""}},[t._v("\n      状态：\n      "),s("v-btn-toggle",{attrs:{mandatory:""},model:{value:t.search.saleable,callback:function(e){t.$set(t.search,"saleable",e)},expression:"search.saleable"}},[s("v-btn",{attrs:{flat:""}},[t._v("\n          全部\n        ")]),t._v(" "),s("v-btn",{attrs:{flat:"",value:!0}},[t._v("\n          上架\n        ")]),t._v(" "),s("v-btn",{attrs:{flat:"",value:!1}},[t._v("\n          下架\n        ")])],1)],1),t._v(" "),s("v-flex",{attrs:{xs3:""}},[s("v-text-field",{attrs:{"append-icon":"search",label:"搜索","single-line":"","hide-details":""},model:{value:t.search.key,callback:function(e){t.$set(t.search,"key",e)},expression:"search.key"}})],1)],1),t._v(" "),s("v-divider"),t._v(" "),s("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.items,pagination:t.pagination,"total-items":t.totalItems,loading:t.loading},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[s("td",{staticClass:"text-xs-center"},[t._v(t._s(e.item.id))]),t._v(" "),s("td",{staticClass:"text-xs-center"},[t._v(t._s(e.item.title))]),t._v(" "),s("td",{staticClass:"text-xs-center"},[t._v(t._s(e.item.categoryName))]),t._v(" "),s("td",{staticClass:"text-xs-center"},[t._v(t._s(e.item.brandName))]),t._v(" "),s("td",{staticClass:"justify-center layout px-0"},[s("v-btn",{attrs:{icon:"",small:""},on:{click:function(s){return t.editItem(e.item)}}},[s("i",{staticClass:"el-icon-edit"})]),t._v(" "),s("v-btn",{attrs:{icon:"",small:""},on:{click:function(s){return t.deleteItem(e.item.id)}}},[s("i",{staticClass:"el-icon-delete"})]),t._v(" "),e.item.saleable?s("v-btn",{attrs:{icon:"",small:""}},[t._v("下架")]):s("v-btn",{attrs:{icon:""}},[t._v("上架")])],1)]}},{key:"pageText",fn:function(e){return[t._v("\n      共"+t._s(e.itemsLength)+"条,当前:"+t._s(e.pageStart)+" - "+t._s(e.pageStop)+"\n    ")]}}])},[t._v(" "),s("template",{slot:"no-data"},[s("v-alert",{attrs:{value:!0,color:"error",icon:"warning"}},[t._v("\n        对不起，没有查询到任何数据 :(\n      ")])],1)],2),t._v(" "),t.show?s("v-dialog",{attrs:{"max-width":"900",scrollable:"",persistent:""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("v-card",[s("v-toolbar",{attrs:{dense:"",dark:"",color:"primary"}},[s("v-toolbar-title",[t._v(t._s(t.isEdit?"修改商品":"新增商品"))]),t._v(" "),s("v-spacer"),t._v(" "),s("v-btn",{attrs:{icon:""},on:{click:t.closeForm}},[s("v-icon",[t._v("close")])],1)],1),t._v(" "),s("v-card-text",{staticStyle:{height:"600px"}},[s("goods-form",{ref:"goodsForm",attrs:{oldGoods:t.selectedGoods,isEdit:t.isEdit,step:t.step},on:{closeForm:t.closeForm}})],1),t._v(" "),s("v-card-actions",[s("v-layout",{attrs:{row:"","justify-center":""}},[s("v-flex",{attrs:{xs2:""}},[s("v-btn",{attrs:{disabled:1===t.step},on:{click:t.lastStep}},[t._v("上一步")])],1),t._v(" "),s("v-flex",{attrs:{xs2:""}},[s("v-btn",{attrs:{disabled:4===t.step,color:"primary"},on:{click:t.nextStep}},[t._v("下一步")])],1)],1)],1)],1)],1):t._e()],1)},staticRenderFns:[]};var n=s("C7Lr")(a,o,!1,function(t){s("97dZ")},"data-v-df1c0940",null);e.default=n.exports},adHB:function(t,e,s){var i=s("Wtcz"),a=s("ZuHZ"),o=s("2gH+");t.exports=function(t,e){var s=(a.Object||{})[t]||Object[t],n={};n[t]=e(s),i(i.S+i.F*o(function(){s(1)}),"Object",n)}},vsuj:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("ZLEe"),a=s.n(i),o=s("MgeX"),n=s.n(o),l=s("A9zj"),r=s.n(l),c=s("3cXf"),d=s.n(c),u=s("aA9S"),p=s.n(u),v=(s("oTFt"),s("9GaO"),s("v/ij"),s("aiqZ")),f={name:"g",components:{quillEditor:v.quillEditor},props:{step:{type:Number,default:1},isEdit:{type:Boolean,default:!1},oldGoods:Object},data:function(){return{valid:!1,editorOption:{placeholder:"编写商品描述信息，让客户了解你的商品"},brandOptions:[],specifications:[],template:[],skuTemplate:[],skus:[],headers:[],goods:{categories:null,brandId:null,title:"",subTitle:"",spuDetail:{packingList:"",afterService:"",description:"",specTemplate:"",specifications:[]}}}},methods:{deleteOption:function(t,e){this.skuTemplate[t].options.splice(e,1)},loadSku:function(t,e,s,i){for(var a=t[s],o=0;o<a.options.length;o++){var n={};n[a.k]=a.options[o],p()(n,i),s===t.length-1?(n.indexes+=o,e.push(n)):(n.indexes+=o+"_",this.loadSku(t,e,s+1,n))}},submit:function(){var t=this;if(!this.goods.categories||this.goods.categories.length<3)this.$message.error("商品分类填写不正确！");else if(!this.skus||this.skus.length<=0)this.$message.error("请填写sku信息！");else{this.goods.cid1=this.goods.categories[0].id,this.goods.cid2=this.goods.categories[1].id,this.goods.cid3=this.goods.categories[2].id;var e={};this.skuTemplate.forEach(function(t){t.options.length>0&&(e[t.k]=t.options)}),this.goods.spuDetail.specTemplate=d()(e);var s=[];Object.deepCopy(this.specifications,s),s.forEach(function(e){e.params.forEach(function(e){e.global||(e.options=t.skuTemplate[e.k])})}),this.goods.spuDetail.specifications=d()(s),this.goods.skus=this.skus.filter(function(t){return t.enable}).map(function(e){var s=e.price,i=e.stock,a=e.enable,o=e.indexes,l=e.images,c=r()(e,["price","stock","enable","indexes","images"]),u=t.goods.title;return n()(c).forEach(function(t){return u+=" "+t}),{id:e.id||null,enable:a,title:u,images:l&&l.length>0?l.join(","):"",price:t.$format(s),ownSpec:d()(c),indexes:o,stock:{stock:i}}}),this.$http({url:"/item/goods",method:this.isEdit?"put":"post",data:this.goods}).then(function(){t.$message.success("提交商品成功！"),t.$emit("closeForm")}).catch(function(e){console.log(e),t.$message.error("提交商品失败！"),t.$emit("closeForm")})}}},watch:{oldGoods:{deep:!0,handler:function(t){null!=t&&this.isEdit&&Object.deepCopy(t,this.goods)}},"goods.categories":{deep:!0,handler:function(t){var e=this;this.$http.get("/item/brand/cid/"+t[2].id).then(function(t){e.brandOptions=t.data}),this.$http.get("/item/spec/"+t[2].id).then(function(t){e.specifications=t.data,e.template=[],e.skuTemplate=[];for(var s=0;s<e.specifications.length;s++){for(var i=e.specifications[s].params,a=i.length,o=0;o<i.length;o++){var n=i[o];n.global||(e.template.push({k:n.k,options:n.options}),e.skuTemplate.push({k:n.k,options:[]}),a--),e.isEdit&&(n.v=e.goods.spuDetail.specifications[s].params[o].v)}0===a&&(e.specifications[s].empty=!0)}e.isEdit&&e.skuTemplate.forEach(function(t){t.options=e.goods.spuDetail.specTemplate[t.k]})})}},skuTemplate:{deep:!0,handler:function(t){var e=this,s=t.filter(function(t){return t.options.length>0});s.length<=0||(this.headers=[],this.skus=[],this.loadSku(s,this.skus,0,{price:null,stock:null,indexes:"",enable:!1}),this.isEdit&&this.$http.get("/item/goods/sku/list",{params:{id:this.goods.id}}).then(function(t){e.skus.forEach(function(s){t.data.forEach(function(t){s.indexes===t.indexes&&(s.id=t.id,s.price=e.$format(t.price),s.stock=t.stock.stock,s.images=t.images.split(","),s.enable=t.enable)})})}),this.headers=[{text:"price",align:"center",sortable:!1,value:"name"}],this.headers=[],this.skus.length>0&&a()(this.skus[0]).forEach(function(t){var s="80";"indexes"!=t&&("price"==t?(t="价格",s="50"):"stock"==t?(t="库存",s="50"):"enable"==t&&(t="是否启用",s="30"),e.headers.push({text:t,align:"center",sortable:!1,value:t,width:s}))}))}}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-stepper",{attrs:{value:t.step}},[s("v-stepper-header",[s("v-stepper-step",{attrs:{step:"1",complete:t.step>1}},[t._v("基本信息")]),t._v(" "),s("v-divider"),t._v(" "),s("v-stepper-step",{attrs:{step:"2",complete:t.step>2}},[t._v("商品描述")]),t._v(" "),s("v-divider"),t._v(" "),s("v-stepper-step",{attrs:{step:"3",complete:t.step>3}},[t._v("规格参数")]),t._v(" "),s("v-divider"),t._v(" "),s("v-stepper-step",{attrs:{step:"4"}},[t._v("SKU属性")])],1),t._v(" "),s("v-stepper-items",[s("v-stepper-content",{attrs:{step:"1"}},[s("v-layout",{attrs:{"justify-center":""}},[s("v-flex",{attrs:{xs10:""}},[s("v-form",{ref:"basic",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs5:""}},[s("v-cascader",{attrs:{url:"/item/category/list",required:"","show-all-levels":"",label:"商品分类"},model:{value:t.goods.categories,callback:function(e){t.$set(t.goods,"categories",e)},expression:"goods.categories"}})],1),t._v(" "),s("v-flex",{attrs:{"offset-xs2":"",xs5:""}},[s("v-select",{attrs:{label:"所属品牌",items:t.brandOptions,dense:"",autocomplete:"","item-text":"name","item-value":"id",rules:[function(t){return!!t||"品牌不能为空"}],required:""},model:{value:t.goods.brandId,callback:function(e){t.$set(t.goods,"brandId",e)},expression:"goods.brandId"}})],1)],1),t._v(" "),s("v-text-field",{attrs:{label:"商品标题",counter:200,required:"",rules:[function(t){return!!t||"商品标题不能为空"}]},model:{value:t.goods.title,callback:function(e){t.$set(t.goods,"title",e)},expression:"goods.title"}}),t._v(" "),s("v-text-field",{attrs:{label:"商品卖点",counter:200},model:{value:t.goods.subTitle,callback:function(e){t.$set(t.goods,"subTitle",e)},expression:"goods.subTitle"}}),t._v(" "),s("v-text-field",{attrs:{label:"包装清单",counter:1e3,"multi-line":"",rows:3},model:{value:t.goods.spuDetail.packingList,callback:function(e){t.$set(t.goods.spuDetail,"packingList",e)},expression:"goods.spuDetail.packingList"}}),t._v(" "),s("v-text-field",{attrs:{label:"售后服务",counter:1e3,"multi-line":"",rows:3},model:{value:t.goods.spuDetail.afterService,callback:function(e){t.$set(t.goods.spuDetail,"afterService",e)},expression:"goods.spuDetail.afterService"}}),t._v(" "),s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs3:""}}),t._v(" "),s("v-flex")],1)],1)],1)],1)],1),t._v(" "),s("v-stepper-content",{attrs:{step:"2"}},[s("quill-editor",{attrs:{options:t.editorOption},model:{value:t.goods.spuDetail.description,callback:function(e){t.$set(t.goods.spuDetail,"description",e)},expression:"goods.spuDetail.description"}})],1),t._v(" "),s("v-stepper-content",{attrs:{step:"3"}},[s("v-flex",{attrs:{"offset-xs1":"",xs10:""}},t._l(t.specifications,function(e,i){return e.empty?t._e():s("v-card",{key:i,staticClass:"my-2"},[s("v-card-title",[s("h4",[t._v(t._s(e.group))])]),t._v(" "),s("v-divider"),t._v(" "),s("v-layout",{attrs:{column:"","justify-center":""}},t._l(e.params,function(e,i){return s("v-flex",{key:i,attrs:{xs8:""}},[e.global?s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{"offset-xs2":"",xs8:""}},[e.options.length<=0?s("v-text-field",{attrs:{suffix:e.unit||"",label:e.k},model:{value:e.v,callback:function(s){t.$set(e,"v",s)},expression:"param.v"}}):s("v-select",{attrs:{label:e.k,items:e.options},model:{value:e.v,callback:function(s){t.$set(e,"v",s)},expression:"param.v"}})],1)],1):t._e()],1)}),1)],1)}),1)],1),t._v(" "),s("v-stepper-content",{attrs:{step:"4"}},[s("v-layout",{attrs:{column:""}},[s("h3",[t._v("sku属性：")]),t._v(" "),s("v-divider"),t._v(" "),s("v-flex",{attrs:{"offset-xs1":""}},t._l(t.template,function(e,i){return s("div",{key:i},[s("h4",[t._v(t._s(e.k)+":")]),t._v(" "),e.options.length<=0?s("div",{staticClass:"px-5"},[s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs8:""}},[s("v-text-field",{attrs:{label:"请输入新的"+e.k},model:{value:t.skuTemplate[i].options[0],callback:function(e){t.$set(t.skuTemplate[i].options,0,e)},expression:"skuTemplate[i].options[0]"}})],1),t._v(" "),s("v-spacer"),t._v(" "),s("v-flex",{attrs:{xs1:""}},[s("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){return t.deleteOption(i,0)}}},[s("i",{staticClass:"el-icon-delete"})])],1)],1),t._v(" "),t._l(t.skuTemplate[i].options.length,function(a){return s("v-layout",{key:a,attrs:{row:""}},[s("v-flex",{attrs:{xs8:""}},[s("v-text-field",{attrs:{label:"请输入新的"+e.k},model:{value:t.skuTemplate[i].options[a],callback:function(e){t.$set(t.skuTemplate[i].options,a,e)},expression:"skuTemplate[i].options[i2]"}})],1),t._v(" "),s("v-spacer"),t._v(" "),s("v-flex",{attrs:{xs1:""}},[s("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){return t.deleteOption(i,a)}}},[s("i",{staticClass:"el-icon-delete"})])],1)],1)})],2):s("div",{staticClass:"px-5"},[s("v-container",{attrs:{fluid:"","grid-list-xs":""}},[s("v-layout",{attrs:{row:"",wrap:""}},t._l(e.options,function(e){return s("v-flex",{key:e,attrs:{xs3:""}},[s("v-checkbox",{attrs:{color:"primary",label:e,value:e},model:{value:t.skuTemplate[i].options,callback:function(e){t.$set(t.skuTemplate[i],"options",e)},expression:"skuTemplate[i].options"}})],1)}),1)],1)],1)])}),0),t._v(" "),s("v-divider"),t._v(" "),s("h3",[t._v("sku列表：")]),t._v(" "),s("v-flex",[s("v-data-table",{staticClass:"elevation-2",attrs:{headers:t.headers,items:t.skus,"hide-actions":"","item-key":"indexes"},scopedSlots:t._u([{key:"items",fn:function(e){return[s("tr",{on:{click:function(t){e.expanded=!e.expanded}}},[t._l(Object.entries(e.item),function(e){var i=e[0],a=e[1];return["id","price","stock","enable","indexes","images"].includes(i)?t._e():s("td",{key:i,staticClass:"text-xs-center"},[t._v(t._s(a)+"\n                ")])}),t._v(" "),s("td",{staticClass:"text-xs-center"},[s("v-text-field",{attrs:{"single-line":"",label:"0",rules:[function(t){return/^([1-9]\d*)\.?(\d{0,2})$/.test(t)||"价格格式错误"}]},model:{value:e.item.price,callback:function(s){t.$set(e.item,"price",s)},expression:"props.item.price"}})],1),t._v(" "),s("td",{staticClass:"text-xs-center"},[s("v-text-field",{attrs:{"single-line":"",label:"0",rules:[function(t){return/^[1-9]\d*$/.test(t)||"库存必须是整数"}]},model:{value:e.item.stock,callback:function(s){t.$set(e.item,"stock",s)},expression:"props.item.stock"}})],1),t._v(" "),s("td",{staticClass:"text-xs-center"},[s("v-checkbox",{model:{value:e.item.enable,callback:function(s){t.$set(e.item,"enable",s)},expression:"props.item.enable"}})],1)],2)]}},{key:"expand",fn:function(e){return e.item.enable?[s("v-card",{staticClass:"pb-3",attrs:{flat:""}},[s("v-card-title",[t._v("为商品上传图片：")]),t._v(" "),s("v-card-text",[s("v-upload",{attrs:{multiple:"",url:"/item/upload"},model:{value:e.item.images,callback:function(s){t.$set(e.item,"images",s)},expression:"props.item.images"}})],1)],1)]:void 0}}],null,!0)},[t._v(" "),t._v(" "),s("template",{slot:"no-data"},[s("v-alert",{attrs:{value:!0,color:"warning",icon:"warning"}},[t._v("\n                请至少选择一个商品属性\n              ")])],1)],2)],1)],1),t._v(" "),s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{"offset-xs5":"",xs2:""}},[s("v-btn",{attrs:{color:"primary"},on:{click:t.submit}},[t._v("保存商品")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var h=s("C7Lr")(f,m,!1,function(t){s("UPbl")},"data-v-1eb3d685",null);e.default=h.exports}});
//# sourceMappingURL=3.984f78d3285016cd3587.js.map