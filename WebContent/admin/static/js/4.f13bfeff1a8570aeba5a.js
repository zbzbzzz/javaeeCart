webpackJsonp([4],{"+6Bu":function(e,t,s){"use strict";t.__esModule=!0,t.default=function(e,t){var s={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s}},Cdx3:function(e,t,s){var i=s("sB3e"),o=s("lktj");s("uqUo")("keys",function(){return function(e){return o(i(e))}})},GOte:function(e,t){},TmV0:function(e,t,s){s("fZOM"),e.exports=s("FeBl").Object.values},fZOM:function(e,t,s){var i=s("kM2E"),o=s("mbce")(!1);i(i.S,"Object",{values:function(e){return o(e)}})},fZjL:function(e,t,s){e.exports={default:s("jFbC"),__esModule:!0}},gRE1:function(e,t,s){e.exports={default:s("TmV0"),__esModule:!0}},jFbC:function(e,t,s){s("Cdx3"),e.exports=s("FeBl").Object.keys},mbce:function(e,t,s){var i=s("lktj"),o=s("TcQ7"),a=s("NpIQ").f;e.exports=function(e){return function(t){for(var s,n=o(t),l=i(n),r=l.length,c=0,u=[];r>c;)a.call(n,s=l[c++])&&u.push(e?[s,n[s]]:n[s]);return u}}},uqUo:function(e,t,s){var i=s("kM2E"),o=s("FeBl"),a=s("S82l");e.exports=function(e,t){var s=(o.Object||{})[e]||Object[e],n={};n[e]=t(s),i(i.S+i.F*a(function(){s(1)}),"Object",n)}},vsuj:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("fZjL"),o=s.n(i),a=s("gRE1"),n=s.n(a),l=s("+6Bu"),r=s.n(l),c=s("mvHQ"),u=s.n(c),p=s("woOf"),d=s.n(p),v=(s("3f40"),s("4qOc"),s("+cgv"),s("G0J2")),f={name:"g",components:{quillEditor:v.quillEditor},props:{step:{type:Number,default:1},isEdit:{type:Boolean,default:!1},oldGoods:Object},data:function(){return{valid:!1,editorOption:{placeholder:"编写商品描述信息，让客户了解你的商品"},brandOptions:[],specifications:[],template:[],skuTemplate:[],skus:[],headers:[],goods:{categories:null,brandId:null,title:"",subTitle:"",spuDetail:{packingList:"",afterService:"",description:"",specTemplate:"",specifications:[]}}}},methods:{deleteOption:function(e,t){this.skuTemplate[e].options.splice(t,1)},loadSku:function(e,t,s,i){for(var o=e[s],a=0;a<o.options.length;a++){var n={};n[o.k]=o.options[a],d()(n,i),s===e.length-1?(n.indexes+=a,t.push(n)):(n.indexes+=a+"_",this.loadSku(e,t,s+1,n))}},submit:function(){var e=this;if(!this.goods.categories||this.goods.categories.length<3)this.$message.error("商品分类填写不正确！");else if(!this.skus||this.skus.length<=0)this.$message.error("请填写sku信息！");else{this.goods.cid1=this.goods.categories[0].id,this.goods.cid2=this.goods.categories[1].id,this.goods.cid3=this.goods.categories[2].id;var t={};this.skuTemplate.forEach(function(e){e.options.length>0&&(t[e.k]=e.options)}),this.goods.spuDetail.specTemplate=u()(t);var s=[];Object.deepCopy(this.specifications,s),s.forEach(function(t){t.params.forEach(function(t){t.global||(t.options=e.skuTemplate[t.k])})}),this.goods.spuDetail.specifications=u()(s),this.goods.skus=this.skus.filter(function(e){return e.enable}).map(function(t){var s=t.price,i=t.stock,o=t.enable,a=t.indexes,l=t.images,c=r()(t,["price","stock","enable","indexes","images"]),p=e.goods.title;return n()(c).forEach(function(e){return p+=" "+e}),{id:t.id||null,enable:o,title:p,images:l&&l.length>0?l.join(","):"",price:e.$format(s),ownSpec:u()(c),indexes:a,stock:{stock:i}}}),this.$http({url:"/item/goods",method:this.isEdit?"put":"post",data:this.goods}).then(function(){e.$message.success("提交商品成功！"),e.$emit("closeForm")}).catch(function(t){console.log(t),e.$message.error("提交商品失败！"),e.$emit("closeForm")})}}},watch:{oldGoods:{deep:!0,handler:function(e){null!=e&&this.isEdit&&Object.deepCopy(e,this.goods)}},"goods.categories":{deep:!0,handler:function(e){var t=this;this.$http.get("/item/brand/cid/"+e[2].id).then(function(e){t.brandOptions=e.data}),this.$http.get("/item/spec/"+e[2].id).then(function(e){t.specifications=e.data,t.template=[],t.skuTemplate=[];for(var s=0;s<t.specifications.length;s++){for(var i=t.specifications[s].params,o=i.length,a=0;a<i.length;a++){var n=i[a];n.global||(t.template.push({k:n.k,options:n.options}),t.skuTemplate.push({k:n.k,options:[]}),o--),t.isEdit&&(n.v=t.goods.spuDetail.specifications[s].params[a].v)}0===o&&(t.specifications[s].empty=!0)}t.isEdit&&t.skuTemplate.forEach(function(e){e.options=t.goods.spuDetail.specTemplate[e.k]})})}},skuTemplate:{deep:!0,handler:function(e){var t=this,s=e.filter(function(e){return e.options.length>0});s.length<=0||(this.headers=[],this.skus=[],this.loadSku(s,this.skus,0,{price:null,stock:null,indexes:"",enable:!1}),this.isEdit&&this.$http.get("/item/goods/sku/list",{params:{id:this.goods.id}}).then(function(e){t.skus.forEach(function(s){e.data.forEach(function(e){s.indexes===e.indexes&&(s.id=e.id,s.price=t.$format(e.price),s.stock=e.stock.stock,s.images=e.images.split(","),s.enable=e.enable)})})}),this.headers=[{text:"price",align:"center",sortable:!1,value:"name"}],this.headers=[],this.skus.length>0&&o()(this.skus[0]).forEach(function(e){var s="80";"indexes"!=e&&("price"==e?(e="价格",s="50"):"stock"==e?(e="库存",s="50"):"enable"==e&&(e="是否启用",s="30"),t.headers.push({text:e,align:"center",sortable:!1,value:e,width:s}))}))}}}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-stepper",{attrs:{value:e.step}},[s("v-stepper-header",[s("v-stepper-step",{attrs:{step:"1",complete:e.step>1}},[e._v("基本信息")]),e._v(" "),s("v-divider"),e._v(" "),s("v-stepper-step",{attrs:{step:"2",complete:e.step>2}},[e._v("商品描述")]),e._v(" "),s("v-divider"),e._v(" "),s("v-stepper-step",{attrs:{step:"3",complete:e.step>3}},[e._v("规格参数")]),e._v(" "),s("v-divider"),e._v(" "),s("v-stepper-step",{attrs:{step:"4"}},[e._v("SKU属性")])],1),e._v(" "),s("v-stepper-items",[s("v-stepper-content",{attrs:{step:"1"}},[s("v-layout",{attrs:{"justify-center":""}},[s("v-flex",{attrs:{xs10:""}},[s("v-form",{ref:"basic",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs5:""}},[s("v-cascader",{attrs:{url:"/item/category/list",required:"","show-all-levels":"",label:"商品分类"},model:{value:e.goods.categories,callback:function(t){e.$set(e.goods,"categories",t)},expression:"goods.categories"}})],1),e._v(" "),s("v-flex",{attrs:{"offset-xs2":"",xs5:""}},[s("v-select",{attrs:{label:"所属品牌",items:e.brandOptions,dense:"",autocomplete:"","item-text":"name","item-value":"id",rules:[function(e){return!!e||"品牌不能为空"}],required:""},model:{value:e.goods.brandId,callback:function(t){e.$set(e.goods,"brandId",t)},expression:"goods.brandId"}})],1)],1),e._v(" "),s("v-text-field",{attrs:{label:"商品标题",counter:200,required:"",rules:[function(e){return!!e||"商品标题不能为空"}]},model:{value:e.goods.title,callback:function(t){e.$set(e.goods,"title",t)},expression:"goods.title"}}),e._v(" "),s("v-text-field",{attrs:{label:"商品卖点",counter:200},model:{value:e.goods.subTitle,callback:function(t){e.$set(e.goods,"subTitle",t)},expression:"goods.subTitle"}}),e._v(" "),s("v-text-field",{attrs:{label:"包装清单",counter:1e3,"multi-line":"",rows:3},model:{value:e.goods.spuDetail.packingList,callback:function(t){e.$set(e.goods.spuDetail,"packingList",t)},expression:"goods.spuDetail.packingList"}}),e._v(" "),s("v-text-field",{attrs:{label:"售后服务",counter:1e3,"multi-line":"",rows:3},model:{value:e.goods.spuDetail.afterService,callback:function(t){e.$set(e.goods.spuDetail,"afterService",t)},expression:"goods.spuDetail.afterService"}}),e._v(" "),s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs3:""}}),e._v(" "),s("v-flex")],1)],1)],1)],1)],1),e._v(" "),s("v-stepper-content",{attrs:{step:"2"}},[s("quill-editor",{attrs:{options:e.editorOption},model:{value:e.goods.spuDetail.description,callback:function(t){e.$set(e.goods.spuDetail,"description",t)},expression:"goods.spuDetail.description"}})],1),e._v(" "),s("v-stepper-content",{attrs:{step:"3"}},[s("v-flex",{attrs:{"offset-xs1":"",xs10:""}},e._l(e.specifications,function(t,i){return t.empty?e._e():s("v-card",{key:i,staticClass:"my-2"},[s("v-card-title",[s("h4",[e._v(e._s(t.group))])]),e._v(" "),s("v-divider"),e._v(" "),s("v-layout",{attrs:{column:"","justify-center":""}},e._l(t.params,function(t,i){return s("v-flex",{key:i,attrs:{xs8:""}},[t.global?s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{"offset-xs2":"",xs8:""}},[t.options.length<=0?s("v-text-field",{attrs:{suffix:t.unit||"",label:t.k},model:{value:t.v,callback:function(s){e.$set(t,"v",s)},expression:"param.v"}}):s("v-select",{attrs:{label:t.k,items:t.options},model:{value:t.v,callback:function(s){e.$set(t,"v",s)},expression:"param.v"}})],1)],1):e._e()],1)}))],1)}))],1),e._v(" "),s("v-stepper-content",{attrs:{step:"4"}},[s("v-layout",{attrs:{column:""}},[s("h3",[e._v("sku属性：")]),e._v(" "),s("v-divider"),e._v(" "),s("v-flex",{attrs:{"offset-xs1":""}},e._l(e.template,function(t,i){return s("div",{key:i},[s("h4",[e._v(e._s(t.k)+":")]),e._v(" "),t.options.length<=0?s("div",{staticClass:"px-5"},[s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs8:""}},[s("v-text-field",{attrs:{label:"请输入新的"+t.k},model:{value:e.skuTemplate[i].options[0],callback:function(t){e.$set(e.skuTemplate[i].options,0,t)},expression:"skuTemplate[i].options[0]"}})],1),e._v(" "),s("v-spacer"),e._v(" "),s("v-flex",{attrs:{xs1:""}},[s("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){e.deleteOption(i,0)}}},[s("i",{staticClass:"el-icon-delete"})])],1)],1),e._v(" "),e._l(e.skuTemplate[i].options.length,function(o){return s("v-layout",{key:o,attrs:{row:""}},[s("v-flex",{attrs:{xs8:""}},[s("v-text-field",{attrs:{label:"请输入新的"+t.k},model:{value:e.skuTemplate[i].options[o],callback:function(t){e.$set(e.skuTemplate[i].options,o,t)},expression:"skuTemplate[i].options[i2]"}})],1),e._v(" "),s("v-spacer"),e._v(" "),s("v-flex",{attrs:{xs1:""}},[s("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){e.deleteOption(i,o)}}},[s("i",{staticClass:"el-icon-delete"})])],1)],1)})],2):s("div",{staticClass:"px-5"},[s("v-container",{attrs:{fluid:"","grid-list-xs":""}},[s("v-layout",{attrs:{row:"",wrap:""}},e._l(t.options,function(t){return s("v-flex",{key:t,attrs:{xs3:""}},[s("v-checkbox",{attrs:{color:"primary",label:t,value:t},model:{value:e.skuTemplate[i].options,callback:function(t){e.$set(e.skuTemplate[i],"options",t)},expression:"skuTemplate[i].options"}})],1)}))],1)],1)])})),e._v(" "),s("v-divider"),e._v(" "),s("h3",[e._v("sku列表：")]),e._v(" "),s("v-flex",[s("v-data-table",{staticClass:"elevation-2",attrs:{headers:e.headers,items:e.skus,"hide-actions":"","item-key":"indexes"},scopedSlots:e._u([{key:"items",fn:function(t){return[s("tr",{on:{click:function(e){t.expanded=!t.expanded}}},[e._l(Object.entries(t.item),function(t){var i=t[0],o=t[1];return["id","price","stock","enable","indexes","images"].includes(i)?e._e():s("td",{key:i,staticClass:"text-xs-center"},[e._v(e._s(o)+"\n                ")])}),e._v(" "),s("td",{staticClass:"text-xs-center"},[s("v-text-field",{attrs:{"single-line":"",label:"0",rules:[function(e){return/^([1-9]\d*)\.?(\d{0,2})$/.test(e)||"价格格式错误"}]},model:{value:t.item.price,callback:function(s){e.$set(t.item,"price",s)},expression:"props.item.price"}})],1),e._v(" "),s("td",{staticClass:"text-xs-center"},[s("v-text-field",{attrs:{"single-line":"",label:"0",rules:[function(e){return/^[1-9]\d*$/.test(e)||"库存必须是整数"}]},model:{value:t.item.stock,callback:function(s){e.$set(t.item,"stock",s)},expression:"props.item.stock"}})],1),e._v(" "),s("td",{staticClass:"text-xs-center"},[s("v-checkbox",{model:{value:t.item.enable,callback:function(s){e.$set(t.item,"enable",s)},expression:"props.item.enable"}})],1)],2)]}},{key:"expand",fn:function(t){return t.item.enable?[s("v-card",{staticClass:"pb-3",attrs:{flat:""}},[s("v-card-title",[e._v("为商品上传图片：")]),e._v(" "),s("v-card-text",[s("v-upload",{attrs:{multiple:"",url:"/item/upload"},model:{value:t.item.images,callback:function(s){e.$set(t.item,"images",s)},expression:"props.item.images"}})],1)],1)]:void 0}}])},[s("template",{slot:"no-data"},[s("v-alert",{attrs:{value:!0,color:"warning",icon:"warning"}},[e._v("\n                请至少选择一个商品属性\n              ")])],1)],2)],1)],1),e._v(" "),s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{"offset-xs5":"",xs2:""}},[s("v-btn",{attrs:{color:"primary"},on:{click:e.submit}},[e._v("保存商品")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var g=s("VU/8")(f,m,!1,function(e){s("GOte")},"data-v-0ab3c0de",null);t.default=g.exports}});
//# sourceMappingURL=4.f13bfeff1a8570aeba5a.js.map